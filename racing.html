<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Vocab Racing Game</title>

<style>
:root{--bg:#0f1724;--card:#0b1220;--accent:#06b6d4;--bad:#ef4444;--muted:#94a3b8;color-scheme:dark}
*{box-sizing:border-box;font-family:Inter,system-ui}
body{
  margin:0;min-height:100vh;
  background:linear-gradient(180deg,#071022,#071827);
  color:#e6eef6;
  display:flex;justify-content:center;align-items:center;
  padding:24px
}
.wrap{max-width:960px;width:100%}
.panel{
  background:var(--card);
  padding:16px;
  border-radius:12px;
  box-shadow:0 6px 18px rgba(2,6,23,.6)
}
textarea{
  width:100%;height:200px;
  background:#071125;
  border:1px solid rgba(255,255,255,.06);
  border-radius:8px;
  color:inherit;
  padding:12px
}
button{
  background:var(--accent);
  border:0;
  padding:10px 14px;
  border-radius:10px;
  font-weight:600;
  cursor:pointer;
  transition:.2s
}
button:hover{transform:scale(1.05)}
.hidden{display:none}

.definition{
  background:#071125;
  border-radius:10px;
  padding:18px;
  margin-top:12px;
  font-size:1.1rem
}

.choices{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
  margin-top:16px
}
.choice{
  background:#071125;
  border:1px solid rgba(255,255,255,.06);
  border-radius:10px;
  padding:16px;
  cursor:pointer;
  text-align:center;
  transition:.2s
}
.choice:hover{border-color:var(--accent)}

.track{
  margin-top:18px;
  background:#020617;
  border-radius:10px;
  overflow:hidden
}
.bar{
  height:18px;
  width:0%;
  background:linear-gradient(90deg,var(--accent),#22d3ee);
  transition:width .3s ease
}
.bar.bad{background:linear-gradient(90deg,var(--bad),#f87171)}

.info{margin-top:12px;color:var(--muted)}
</style>
</head>

<body>
<div class="wrap">

<div id="startScreen" class="panel">
<h1>Vocab Racing Game</h1>
<p class="info">Odd line = word, even line = definition</p>
<textarea id="pairs"></textarea>
<div style="margin-top:12px">
<label class="info">Mode</label><br>
<select id="mode" style="margin-top:6px;padding:8px;border-radius:8px;background:#071125;color:#e6eef6;border:1px solid rgba(255,255,255,.06)">
<option value="wd">Show word → guess definition</option>
<option value="dw">Show definition → guess word</option>
<option value="random">Random</option>
</select>
</div>
<div style="margin-top:12px;display:flex;gap:8px">
<button id="play">Play</button>
<button id="clear">Clear</button>
</div>
</div>

<div id="gameScreen" class="panel hidden">
<h1>Pick the Correct Answer</h1>
<div id="definition" class="definition"></div>
<div id="choices" class="choices"></div>
<div class="track"><div id="progress" class="bar"></div></div>
<div class="info">Finish the race by getting answers right</div>
<div style="margin-top:12px">
<button id="stop">Stop</button>
</div>
</div>

</div>

<div id="gameScreen" class="panel hidden">
<h1>Pick the Correct Answer</h1>
<div id="definition" class="definition"></div>
<div id="choices" class="choices"></div>
<div class="track"><div id="progress" class="bar"></div></div>
<div class="info">Finish the race by getting answers right</div>
<div style="margin-top:12px">
<button id="stop">Stop</button>
</div>
</div>

<script>
const pairsTA = document.getElementById('pairs');
const playBtn = document.getElementById('play');
const clearBtn = document.getElementById('clear');
const stopBtn = document.getElementById('stop');
const startScreen = document.getElementById('startScreen');
const gameScreen = document.getElementById('gameScreen');
const defEl = document.getElementById('definition');
const choicesEl = document.getElementById('choices');
const bar = document.getElementById('progress');
const modeSel = document.getElementById('mode');

let pairs = [];
let unused = [];
let progress = 0;
const FINISH = 100;

// FIXED: valid regular expression for splitting lines
function parsePairs(text){
  const lines = text.split(/\n+/).map(l=>l.trim()).filter(Boolean);
  const out=[];
  for(let i=0;i<lines.length;i+=2){
    if(lines[i+1]) out.push({word:lines[i],def:lines[i+1]});
  }
  return out;
}

function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
}

function nextQuestion(){
  if(unused.length===0) unused = [...pairs];
  shuffle(unused);

  const correct = unused.pop();
  const mode = modeSel.value === 'random'
    ? (Math.random()<0.5 ? 'wd':'dw')
    : modeSel.value;

  let prompt, answers, correctAnswer;

  if(mode === 'dw'){
    prompt = correct.def;
    correctAnswer = correct.word;
    answers = [correct.word];
    const pool = pairs.filter(p=>p!==correct);
    shuffle(pool);
    while(answers.length<4 && pool.length){
      answers.push(pool.pop().word);
    }
  }else{
    prompt = correct.word;
    correctAnswer = correct.def;
    answers = [correct.def];
    const pool = pairs.filter(p=>p!==correct);
    shuffle(pool);
    while(answers.length<4 && pool.length){
      answers.push(pool.pop().def);
    }
  }

  shuffle(answers);
  defEl.textContent = prompt;
  choicesEl.innerHTML='';

  answers.forEach(a=>{
    const d=document.createElement('div');
    d.className='choice';
    d.textContent=a;
    d.onclick=()=>pick(a===correctAnswer);
    choicesEl.appendChild(d);
  });
}

function pick(ok){
  if(ok){
    progress = Math.min(FINISH, progress + 10);
    bar.style.width = progress + '%';
    bar.classList.remove('bad');
    if(progress>=FINISH){
      defEl.textContent='You finished the race!';
      choicesEl.innerHTML='';
      return;
    }
    nextQuestion();
  }else{
    bar.classList.add('bad');
    setTimeout(()=>bar.classList.remove('bad'),300);
  }
}

playBtn.onclick=()=>{
  pairs = parsePairs(pairsTA.value);
  if(pairs.length<4){alert('Need at least 4 pairs');return;}
  localStorage.setItem('racingPairs',pairsTA.value);
  localStorage.setItem('racingMode',modeSel.value);
  unused=[...pairs];
  progress=0;
  bar.style.width='0%';
  nextQuestion();
  startScreen.classList.add('hidden');
  gameScreen.classList.remove('hidden');
};

clearBtn.onclick=()=>{
  pairsTA.value='';
  localStorage.removeItem('racingPairs');
};

stopBtn.onclick=()=>{
  gameScreen.classList.add('hidden');
  startScreen.classList.remove('hidden');
};

window.onload=()=>{
  const saved=localStorage.getItem('racingPairs');
  if(saved)pairsTA.value=saved;
  const m=localStorage.getItem('racingMode');
  if(m) modeSel.value=m;
};

// BASIC TESTS
console.assert(parsePairs('a\nb').length===1,'Single pair parsed');
console.assert(parsePairs('a\nb\nc').length===1,'Odd line ignored');
console.assert(parsePairs('a\nb\nc\nd').length===2,'Two pairs parsed');
</script>
</body>
</html>
