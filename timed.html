<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Vocab Quiz Game</title>
<style>
  :root{--bg:#0f1724;--card:#0b1220;--accent:#06b6d4;--muted:#94a3b8;color-scheme:dark}
  *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial}
  body{margin:0;min-height:100vh;background:linear-gradient(180deg,#071022 0%,#071827 100%);color:#e6eef6;display:flex;align-items:center;justify-content:center;padding:24px;transition:background-color 0.5s ease}
  .wrap{width:100%;max-width:700px}
  h1{margin:0 0 16px;font-size:24px}
  .panel{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,.6)}
  textarea{width:100%;height:180px;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:#071125;color:inherit;resize:vertical}
  button{background:var(--accent);border:0;padding:10px 14px;border-radius:10px;color:#042027;font-weight:600;cursor:pointer;transition:all .2s ease;box-shadow:0 2px 6px rgba(6,182,212,0.2)}
  button:hover{transform:scale(1.08);box-shadow:0 4px 16px rgba(6,182,212,0.45)}
  button:active{transform:scale(0.96)}
  select, input[type=range]{width:100%;padding:8px;border-radius:8px;background:#071125;border:1px solid rgba(255,255,255,0.08);color:#e6eef6;margin-top:4px}
  input[type=text]{width:100%;padding:10px;border-radius:8px;background:#071125;border:1px solid rgba(255,255,255,0.08);color:#e6eef6;margin-top:8px}
  .hidden{display:none}
  .info{margin-top:12px;font-size:14px;color:var(--muted)}
  .question{text-align:center;font-size:20px;margin:16px 0}
  .timerBar{height:8px;background:var(--accent);border-radius:6px;transition:width 0.2s linear;margin-top:8px}
  .results{margin-top:12px}
  table{width:100%;border-collapse:collapse;margin-top:12px}
  td,th{border:1px solid rgba(255,255,255,0.1);padding:6px;text-align:left}
  th{background:#071125}
  /* Stamp Style */
  .grade-stamp {
    position:absolute;
    top:20px;
    right:40px;
    font-size:80px;
    font-weight:900;
    opacity:0.25;
    transform:rotate(-10deg) scale(0.8);
    animation:stampIn 0.7s ease forwards;
    text-shadow:2px 2px 6px rgba(0,0,0,0.4);
  }
  @keyframes stampIn {
    0% {opacity:0; transform:scale(3) rotate(-10deg);}
    60% {opacity:0.3; transform:scale(1.05) rotate(-10deg);}
    100% {opacity:0.25; transform:scale(0.8) rotate(-10deg);}
  }
</style>
</head>
<body>
<div class="wrap">
  <!-- Start Menu -->
  <div id="menuScreen" class="panel">
    <h1>Vocab Quiz Game</h1>
    <p class="info">Enter pairs: odd line = word, even line = definition.</p>
    <textarea id="pairs"></textarea>

    <label>Mode:</label>
    <select id="mode">
      <option value="word">Show Word → Guess Definition</option>
      <option value="definition">Show Definition → Guess Word</option>
      <option value="random">Random</option>
    </select>

    <label>Time per Question: <span id="timeLabel">10</span> sec</label>
    <input type="range" id="timeSlider" min="1" max="60" value="10">

    <div style="margin-top:12px;display:flex;gap:8px">
      <button id="startBtn">Start</button>
      <button id="clearBtn">Clear</button>
    </div>
  </div>

  <!-- Game -->
  <div id="gameScreen" class="panel hidden">
    <h1>Answer Quickly!</h1>
    <div class="question" id="questionText"></div>
    <input type="text" id="answerInput" placeholder="Type your answer...">
    <div class="timerBar" id="timerBar"></div>
    <div class="info" id="progressInfo"></div>
  </div>

  <!-- Results -->
  <div id="resultScreen" class="panel hidden" style="position:relative;">
    <h1>Results</h1>
    <div id="gradeStamp" class="grade-stamp hidden"></div>
    <p id="scoreText"></p>
    <div class="results" id="resultsTable"></div>
    <button id="menuBtn">Main Menu</button>
  </div>
</div>

<script>
  const pairsTA = document.getElementById('pairs');
  const modeSel = document.getElementById('mode');
  const timeSlider = document.getElementById('timeSlider');
  const timeLabel = document.getElementById('timeLabel');
  const startBtn = document.getElementById('startBtn');
  const clearBtn = document.getElementById('clearBtn');
  const menuScreen = document.getElementById('menuScreen');
  const gameScreen = document.getElementById('gameScreen');
  const resultScreen = document.getElementById('resultScreen');
  const questionText = document.getElementById('questionText');
  const answerInput = document.getElementById('answerInput');
  const timerBar = document.getElementById('timerBar');
  const progressInfo = document.getElementById('progressInfo');
  const scoreText = document.getElementById('scoreText');
  const resultsTable = document.getElementById('resultsTable');
  const menuBtn = document.getElementById('menuBtn');
  const gradeStamp = document.getElementById('gradeStamp');

  let pairs = [];
  let currentIndex = 0;
  let timeLimit = 10;
  let timerInterval;
  let remaining = 0;
  let results = [];

  timeSlider.addEventListener('input',()=>{
    timeLabel.textContent = timeSlider.value;
  });

  function parsePairs(text){
    const lines = text.split(/\n+/).map(l=>l.trim()).filter(Boolean);
    const out = [];
    for(let i=0;i<lines.length;i+=2){
      if(lines[i+1]) out.push({word:lines[i],def:lines[i+1]});
    }
    return out;
  }

  function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}

  function flashBackground(color){
    document.body.style.backgroundColor = color;
    setTimeout(()=>{document.body.style.background="linear-gradient(180deg,#071022 0%,#071827 100%)";},300);
  }

  function startGame(){
    pairs = parsePairs(pairsTA.value);
    if(pairs.length<1){alert("Please enter at least one pair.");return;}
    shuffle(pairs);
    currentIndex = 0;
    results = [];
    timeLimit = parseInt(timeSlider.value);
    menuScreen.classList.add('hidden');
    resultScreen.classList.add('hidden');
    gameScreen.classList.remove('hidden');
    nextQuestion();
  }

  function nextQuestion(){
    if(currentIndex >= pairs.length){ endGame(); return; }

    const p = pairs[currentIndex];
    let showSide, expectSide;
    const mode = modeSel.value;
    if(mode === "word"){ showSide = "word"; expectSide = "def"; }
    else if(mode === "definition"){ showSide = "def"; expectSide = "word"; }
    else {
      if(Math.random()<0.5){ showSide="word"; expectSide="def"; }
      else { showSide="def"; expectSide="word"; }
    }

    questionText.textContent = p[showSide];
    answerInput.value = '';
    answerInput.focus();
    progressInfo.textContent = `Question ${currentIndex+1} of ${pairs.length}`;
    remaining = timeLimit;
    timerBar.style.width = "100%";

    clearInterval(timerInterval);
    timerInterval = setInterval(()=>{
      remaining -= 0.1;
      const pct = Math.max(0, remaining/timeLimit)*100;
      timerBar.style.width = pct+"%";
      if(remaining <= 0){
        clearInterval(timerInterval);
        recordAnswer("", p[expectSide], p[showSide], showSide, expectSide);
      }
    },100);

    answerInput.onkeydown = (e)=>{
      if(e.key === "Enter"){
        clearInterval(timerInterval);
        recordAnswer(answerInput.value.trim(), p[expectSide], p[showSide], showSide, expectSide);
      }
    };
  }

  function recordAnswer(answer, correct, prompt, showSide, expectSide){
    const isCorrect = answer.toLowerCase() === correct.toLowerCase();
    if(isCorrect) flashBackground("rgba(22,163,74,0.3)");
    else flashBackground("rgba(239,68,68,0.3)");

    results.push({
      promptType: showSide,
      prompt: prompt,
      expected: correct,
      answer: answer || "(no answer)",
      correct: isCorrect
    });
    currentIndex++;
    setTimeout(nextQuestion, 400);
  }

  function getLetterGrade(pct){
    if(pct>=97) return "A+";
    if(pct>=93) return "A";
    if(pct>=90) return "A-";
    if(pct>=87) return "B+";
    if(pct>=83) return "B";
    if(pct>=80) return "B-";
    if(pct>=77) return "C+";
    if(pct>=73) return "C";
    if(pct>=70) return "C-";
    if(pct>=67) return "D+";
    if(pct>=63) return "D";
    if(pct>=60) return "D-";
    return "F";
  }

  function getGradeColor(letter){
    if(["A+","A","A-","B+"].includes(letter)) return "limegreen";
    if(["B","B-","C+"].includes(letter)) return "#3b82f6";
    if(["C","C-","D+"].includes(letter)) return "#f97316";
    return "#ef4444";
  }

  function endGame(){
    gameScreen.classList.add('hidden');
    resultScreen.classList.remove('hidden');
    const correctCount = results.filter(r=>r.correct).length;
    const pct = Math.round((correctCount / results.length)*100);
    const grade = getLetterGrade(pct);
    const color = getGradeColor(grade);

    scoreText.textContent = `You got ${correctCount}/${results.length} correct (${pct}%)`;
    let html = `<table><tr><th>Prompt</th><th>Your Answer</th><th>Correct</th></tr>`;
    for(const r of results){
      const colorA = r.correct ? "style='color:#16a34a'" : "style='color:#ef4444'";
      html += `<tr><td>${r.prompt}</td><td ${colorA}>${r.answer}</td><td>${r.expected}</td></tr>`;
    }
    html += `</table>`;
    resultsTable.innerHTML = html;

    gradeStamp.textContent = grade;
    gradeStamp.style.color = color;
    gradeStamp.classList.remove('hidden');
  }

  startBtn.onclick = startGame;
  clearBtn.onclick = ()=>{ pairsTA.value=''; localStorage.removeItem('vocabPairs'); };
  menuBtn.onclick = ()=>{
    gradeStamp.classList.add('hidden');
    resultScreen.classList.add('hidden');
    menuScreen.classList.remove('hidden');
  };

  window.addEventListener('load',()=>{
    const saved = localStorage.getItem('vocabPairs');
    if(saved) pairsTA.value = saved;
  });
  window.addEventListener('beforeunload',()=>{
    localStorage.setItem('vocabPairs', pairsTA.value);
  });
</script>
</body>
</html>
